# メドレーアノテーションWebアプリケーション実装方針

## プロジェクト概要

Anasuiは、ニコニコ動画とYouTubeのメドレー楽曲に対するアノテーション（楽曲情報の注釈）を提供するWebアプリケーションです。各メドレー動画において、どの時間帯にどの楽曲が演奏されているかを視覚的に表示し、ユーザーが楽曲を効率的に楽しめる環境を提供します。

## 現在の実装状況（2025年8月更新）

### ✅ 完全実装済み機能（Phase 1-11）
- ✅ **マルチプラットフォーム対応**: ニコニコ動画 + YouTube両プラットフォーム統合
- ✅ **動的ルーティング**: `/niconico/[videoId]` `/youtube/[videoId]` 個別ページ実装
- ✅ **Supabaseデータベース統合**: PostgreSQL + 静的データフォールバック
- ✅ **高度なアノテーション編集**: ドラッグ&ドロップ、スナップ機能、キーボードショートカット対応
- ✅ **タイムラインズーム機能**: 0.5x-5.0x倍率、自動追従、マウスホイール対応
- ✅ **楽曲データベース統合**: 楽曲検索モーダル、データベース駆動楽曲追加
- ✅ **統合UI**: 最適化されたスティッキーヘッダー、画面利用率向上
- ✅ **プレイヤー制御**: シークバー、音量制御、フルスクリーン対応
- ✅ **楽曲検索**: クロスメドレー楽曲検索、高度フィルタリング
- ✅ **ツールチップシステム**: ホバー詳細表示、スマートポジション調整
- ✅ **履歴管理**: 50アクション undo/redo システム

### 現在の技術スタック
- **フロントエンド**: Next.js 15.2.1 (App Router), React 19.0.0, TypeScript
- **スタイリング**: TailwindCSS 4 + Emotion for CSS-in-JS  
- **データベース**: Supabase PostgreSQL (静的データフォールバック対応)
- **デプロイ**: Netlify (静的エクスポート)
- **プレイヤー統合**: postMessage API (ニコニコ), iframe embed (YouTube)

## 🚀 次期実装計画

### Phase 12: ユーザー認証・協同編集（実装予定）
**目標**: コミュニティによる協同編集でアノテーションの質と量を向上させる

#### 12.1 ユーザー認証システム
- **Supabase Auth統合**: ソーシャルログイン対応（GitHub, Google）
- **編集権限管理**: ゲスト編集 vs 登録ユーザー編集
- **編集者プロフィール**: 貢献度追跡、編集履歴表示

#### 12.2 協同編集機能
- **複数ユーザー同時編集**: リアルタイム競合解決
- **編集履歴管理**: 変更履歴の可視化と復元機能
- **品質管理**: 編集提案システム、レビュー機能

### Phase 13: 高度な検索・発見機能
**目標**: 音楽発見と探索の新たな体験を提供

#### 13.1 インテリジェント検索
- **楽曲類似度検索**: 音響特徴量による類似楽曲推薦
- **タグベース検索**: ジャンル、年代、ムードによる検索
- **トレンド分析**: 人気楽曲、急上昇楽曲の発見

#### 13.2 可視化・分析機能
- **楽曲統計ダッシュボード**: ジャンル分布、アーティスト分析
- **メドレー分析**: 楽曲構成の可視化、テンポ変化分析
- **コミュニティ統計**: 編集活動、人気メドレーランキング

### Phase 14: API・連携機能
**目標**: 外部アプリケーションとの連携とプラットフォーム拡張

#### 14.1 RESTful API提供
- **公開API**: メドレーデータ、楽曲情報のAPI提供
- **ウィジェット**: 外部サイト埋め込み用ウィジェット
- **データエクスポート**: JSON、CSV形式でのデータ提供

#### 14.2 プラットフォーム拡張
- **新プラットフォーム対応**: Twitch、bilibili等への拡張
- **音声解析統合**: 自動楽曲検出、テンポ解析
- **外部音楽サービス連携**: Spotify、Apple Music等との連携

## 📊 プロジェクト成果・実績

### 現在の実装完了率: **約75%**
- **コア機能**: 100% 完了 (プレイヤー統合、タイムライン、編集機能)
- **プラットフォーム対応**: 100% 完了 (ニコニコ + YouTube)
- **UI/UX**: 95% 完了 (統合ヘッダー、レスポンシブデザイン)
- **データ管理**: 90% 完了 (Supabase統合、楽曲データベース)
- **高度機能**: 85% 完了 (ズーム、検索、ツールチップ)

### 技術的成果
- **マルチプラットフォーム設計**: 拡張可能なアーキテクチャ実現
- **パフォーマンス最適化**: 画面利用率を26.8%→15%に大幅改善
- **ユーザビリティ向上**: 直感的なドラッグ&ドロップ編集システム
- **データ統合**: 楽曲データベース統合による一貫性確保

## 技術的検討事項

### データ管理
- **データ正規性**: 楽曲マスターデータの重複排除
- **パフォーマンス**: 大量データの効率的な取得
- **リアルタイム性**: 編集の競合解決

### UI/UX
- **操作性**: 音楽再生中の編集体験
- **視覚性**: タイムラインの見やすさと操作性
- **レスポンシブ**: モバイル端末での利用体験

### インフラ
- **スケーラビリティ**: ユーザー増加への対応
- **可用性**: サービス継続性の確保
- **コスト**: 運用コストの最適化

## 🎯 成功指標・ロードマップ

### ✅ 短期目標達成済み（Phase 1-11完了）
- ✅ 20個以上のメドレーアノテーション登録完了
- ✅ 高度な編集機能実装完了（ドラッグ&ドロップ、履歴管理等）
- ✅ マルチプラットフォーム対応完了

### 🚀 中期目標（Phase 12-13）
- **ユーザー認証システム**: コミュニティ参加促進
- **協同編集機能**: 複数ユーザーによる同時編集
- **高度な検索機能**: インテリジェント楽曲発見

### 🌟 長期目標（Phase 14+）
- **API連携**: 外部アプリケーションとの統合
- **音声解析**: 自動楽曲検出・分析機能
- **プラットフォーム標準化**: メドレー界隈のデファクトスタンダード

### 継続的改善項目
- **パフォーマンス最適化**: ロード時間・レスポンス性向上
- **モバイル体験**: タッチデバイス最適化
- **アクセシビリティ**: WCAG 2.1準拠
- **国際化**: 多言語対応検討