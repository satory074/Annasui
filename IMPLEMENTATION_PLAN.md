# メドレーアノテーションWebアプリケーション実装方針

## プロジェクト概要

Anasuiは、ニコニコ動画のメドレー楽曲に対するアノテーション（楽曲情報の注釈）を提供するWebアプリケーションです。各メドレー動画において、どの時間帯にどの楽曲が演奏されているかを視覚的に表示し、ユーザーが楽曲を効率的に楽しめる環境を提供します。

## 現在の実装状況

### 実装済み機能
- ✅ ニコニコプレイヤー統合（iframe + postMessage API）
- ✅ 楽曲タイムライン表示とクリック操作
- ✅ 楽曲リスト表示と再生制御
- ✅ 静的メドレーデータの管理（`src/data/medleys.ts`）
- ✅ レスポンシブデザイン
- ✅ TypeScript型安全性

### 技術スタック
- Next.js 15.2.1 (App Router)
- React 19.0.0 with TypeScript
- TailwindCSS 4 + Emotion for CSS-in-JS
- Static export for Netlify deployment

## 実現したい機能

### 1. メドレーアノテーションデータベース機能
**目標**: ユーザーがメドレー楽曲アノテーションデータベースとして、このWebアプリケーションを活用できるようにする

#### 1.1 アノテーションデータの永続化
- **現状**: 静的データファイル（`src/data/medleys.ts`）
- **改善**: データベースまたはCMSによる動的データ管理
- **選択肢**: 
  - Supabase（PostgreSQL + リアルタイム機能）
  - Contentful/Strapi（ヘッドレスCMS）
  - GitHub Issues/JSON（簡易実装）

#### 1.2 アノテーション編集機能
- 楽曲の開始/終了時間の手動調整
- 楽曲名、アーティスト名、ジャンル等のメタデータ編集
- タイムライン上でのドラッグ&ドロップ操作
- リアルタイムプレビュー機能

### 2. メドレー楽曲ごとの個別ページ
**目標**: 各メドレーが独立したページとして提供され、共有可能な状態にする

#### 2.1 動的ルーティング
- URL形式: `/medley/[videoId]` または `/[videoId]`
- 例: `https://anasui.com/sm500873`
- OGP対応（タイトル、サムネイル、説明文）

#### 2.2 共有機能
- URLコピー機能
- SNS共有ボタン（Twitter、Facebook等）
- 特定楽曲へのディープリンク

### 3. メドレーデータベース全体機能
**目標**: 複数のメドレーを横断的に検索・参照できるデータベースとして機能させる

#### 3.1 メドレー一覧・検索機能
- 登録されているメドレーの一覧表示
- タイトル、クリエイター、ジャンルによる検索
- 楽曲名・アーティスト名による横断検索
- フィルタリング機能（年代、ジャンル、再生時間等）

#### 3.2 メタデータ管理
- メドレーのタグ・カテゴリ分類
- 人気ランキング（再生数、お気に入り数）
- 最近更新されたメドレー表示

### 4. ユーザー投稿・編集機能
**目標**: コミュニティによる協同編集でアノテーションの質と量を向上させる

#### 4.1 新規メドレー登録
- ニコニコ動画IDを入力して新規登録
- 動画メタデータの自動取得
- 初期アノテーションの作成支援

#### 4.2 協同編集機能
- 複数ユーザーによる編集（Wikipedia方式）
- 編集履歴の管理と復元機能
- 編集者の貢献度追跡

## 実装計画

### Phase 1: データ永続化基盤
1. **データベース選択と設計**
   - Supabaseのセットアップ
   - メドレーデータのER図設計
   - 既存データのマイグレーション

2. **API層の実装**
   - CRUD操作のエンドポイント設計
   - TypeScript型定義の更新
   - データ取得ロジックの置き換え

### Phase 2: アノテーション編集機能
1. **編集UI コンポーネント**
   - モーダルベースの編集フォーム
   - タイムライン上の編集インターフェース
   - リアルタイムプレビュー

2. **編集機能の実装**
   - 楽曲セグメントの追加/削除/編集
   - ドラッグ&ドロップによる時間調整
   - 編集内容の保存/キャンセル

### Phase 3: 動的ルーティングと個別ページ
1. **ページ構造の変更**
   - `/[videoId]` 動的ルートの実装
   - 既存コンポーネントの再利用
   - OGP メタデータの動的生成

2. **共有機能**
   - URLコピー機能
   - ソーシャル共有ボタン
   - ディープリンク対応

### Phase 4: データベース機能
1. **一覧・検索ページ**
   - メドレー一覧ページ (`/medleys`)
   - 検索・フィルタリング機能
   - ページネーション

2. **横断検索機能**
   - 楽曲名・アーティスト名での検索
   - 全文検索の実装
   - 検索結果の最適化

### Phase 5: ユーザー機能
1. **ユーザー認証**
   - 編集者識別のための認証システム
   - ゲスト編集 vs 登録ユーザー編集

2. **投稿・編集機能**
   - 新規メドレー投稿フォーム
   - 編集履歴管理
   - 品質管理システム

## 技術的検討事項

### データ管理
- **データ正規性**: 楽曲マスターデータの重複排除
- **パフォーマンス**: 大量データの効率的な取得
- **リアルタイム性**: 編集の競合解決

### UI/UX
- **操作性**: 音楽再生中の編集体験
- **視覚性**: タイムラインの見やすさと操作性
- **レスポンシブ**: モバイル端末での利用体験

### インフラ
- **スケーラビリティ**: ユーザー増加への対応
- **可用性**: サービス継続性の確保
- **コスト**: 運用コストの最適化

## 成功指標

### 短期目標（3ヶ月）
- 20個以上のメドレーアノテーション登録
- 編集機能の基本操作完成
- ユーザーフィードバックの収集

### 中期目標（6ヶ月）
- 100個以上のメドレーデータベース構築
- 月間アクティブユーザー 1,000人
- コミュニティによる自律的な編集活動

### 長期目標（1年）
- ニコニコメドレー界隈の標準的なアノテーションプラットフォーム
- 外部アプリケーションとのAPI連携
- 音楽発見・探索の新たな体験提供